{% load static %}
{% load bootstrap4 %}
{% load i18n %}

<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% blocktrans %}consultar factura{% endblocktrans %}</title>
  <link rel="stylesheet" href="{% static 'dist/css/estilos2.css' %}">
  <link rel="stylesheet" href="{% static 'plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css' %}">
  <!-- Tell the browser to be responsive to screen width -->
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
  <!-- Ionicons -->
  <link rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
  <!-- Tempusdominus Bbootstrap 4 -->
  <link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css'%}">
  <!-- iCheck -->
  <link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css'%}">
  <!-- Theme style -->
  <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css'%}">
  <!-- overlayScrollbars -->
  <link rel="stylesheet" href="{% static 'plugins/overlayScrollbars/css/OverlayScrollbars.min.css'%}">
  <!-- Daterange picker -->
  <link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css'%}">
  <!-- Google Font: Source Sans Pro -->
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700" rel="stylesheet">
  <!-- Toastr -->
  <link rel="stylesheet" href="{% static 'plugins/toastr/toastr.min.css' %}">
  <!--Leaflet-->
  <link rel="stylesheet" href="{% static 'plugins/leaflet/leaflet.css' %}">
  {% block css %}{% endblock css %}
</head>

<body class="hold-transition sidebar-mini">
  <!-- Main content -->
  <div class="contenedor-invoice" id="pdf">
    <div class="invoice p-3 mb-3">
      <!-- title row -->
      <div class="row">
        <div class="col-12">
          <h2>
            <i class="fas fa-bolt"></i> Electrisoft
            <small class="float-right">Fecha de generación:
              <script> document.write(new Date().toLocaleDateString()); </script>
            </small>
          </h2>
        </div>
        <!-- /.col -->
      </div>
      <!-- info row -->
      <div class="row invoice-info">
        <div class="col-sm-4 invoice-col">
          <address>
            <strong>Electrisoft, Inc.</strong><br>
            NIT 890.399.003-4<br>
            Cra 77 A N° 2B - 34<br>
            Teléfono: 01 8000 910305<br>
          </address>
        </div>
        <!-- /.col -->
        <div class="col-sm-4 invoice-col">
          Cliente - {{contrato.cliente.tipo}}
          <address>
            <strong>{{contrato.cliente.first_name}} {{factura.contrato.cliente.last_name}}</strong><br>
            {{contrato.cliente.cedula}}<br>
            {{contrato.direccion}}<br>
            Teléfono: {{contrato.cliente.telefono}}<br>
            Email: {{contrato.cliente.email}}
          </address>
        </div>
        <!-- /.col -->
        <div class="col-sm-4 invoice-col">
          <b>Factura N° <span id="x">xd</span></b><br>
          <script>
            document.write(serial);
          </script>
          <br>
          <b>Contrato:</b> {{contrato.id}}<br>
          <b>Inicio del contrato:</b> {{contrato.fecha_inicio}}<br>
          <b>Estrato:</b> {{contrato.estrato}}
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
      <!-- Table row -->
      <div class="row">
        {% for f in facturas %}
        <div class="col-md-6">
          <!-- Widget: user widget style 2 -->
          <div class="card card-widget widget-user-2">
            <!-- Add the bg color to the header using any of the bg-* classes -->

            <div class="card-footer p-0">
              <ul class="nav flex-column">
                <li class="nav-item">
                  <span class="nav-link">
                    <strong>N° lectura factura <span class="float-right">{{f.id}}</span></strong>
                  </span>
                </li>
                <li class="nav-item">
                  <span class="nav-link">
                    Lectura Actual <span class="float-right">{{f.consumo.lectura_actual}}</span>
                  </span>
                </li>
                <li class="nav-item">
                  <span class="nav-link">
                    Lectura Anterior <span class="float-right">{{f.consumo.lectura_anterior}}</span>
                  </span>
                </li>
                <li class="nav-item">
                  <span class="nav-link">
                    Diferencia <span class="float-right">{{f.diferencia}}</span>
                  </span>
                </li>
                <li class="nav-item">
                  <span class="nav-link">
                    Consumo Actual <span class="float-right">{{f.diferencia}} KWH</span>
                  </span>
                </li>
              </ul>
            </div>
          </div>
          <!-- /.widget-user -->
        </div>

        <div class="col-6 table-responsive">
          <table class="table table-striped">
            <thead>
              <tr>
                <th>CONCEPTOS</th>
                <th>Cantidad</th>
                <th>V. Unitario</th>
                <th>Total</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Consumo de Energia Activa</td>
                <td>{{f.diferencia}}</td>
                <td>550,0</td>
                {% if forloop.first %}
                <td>{{subtotal1}}</td>
                {% else %}
                <td>{{subtotal2}}</td>
                {% endif %}
              </tr>
              <tr>
                <td>Interes de Mora</td>
                <td></td>
                <td></td>
                <td>{{f.cargo_mora}}</td>
              </tr>
              <tr>
                <td>TOTAL</td>
                <td></td>
                <td></td>
                <td>{{f.total}}</td>
              </tr>
            </tbody>
          </table>
        </div>
        {% endfor %}
        <!-- /.col -->
      </div>
      <div class="row">
        <div class="col-md-6">
          <!-- Widget: user widget style 2 -->
          <div class="card card-widget widget-user-2">
            <!-- Add the bg color to the header using any of the bg-* classes -->
            <div class="card-footer p-0">
              <ul class="nav flex-column">
                <li class="nav-item">
                  <span class="nav-link">
                    Direccion Instalación <span class="float-right">31</span>
                  </span>
                </li>
                <li class="nav-item">
                  <span class="nav-link">
                    {% if contrato.cliente.tipo == 'persona natural' %}
                    Uso <span class="float-right">Residencial</span>
                    {% else %}
                    Uso <span class="float-right">Empresarial</span>
                    {% endif %}
                  </span>
                </li>
                <li class="nav-item">
                  <span class="nav-link">
                    Estrato <span class="float-right">{{contrato.estrato}}</span>
                  </span>
                </li>
                <li class="nav-item">
                  <span class="nav-link">
                    No. Contador <span class="float-right">{{contrato.contador.id}}</span>
                  </span>
                </li>
                <li class="nav-item">
                  <span class="nav-link">
                    Modelo Contador <span class="float-right">{{contrato.contador.modelo}}</span>
                  </span>
                </li>
              </ul>
            </div>
          </div>
          <!-- /.widget-user -->
        </div>
        <!-- /.col -->

        <!-- /.col -->
      </div>
      <!-- /.row -->

      <div class="row">
        <!-- accepted payments column -->
        <div class="col-6">
          <p class="lead">Metodos de pago:</p>
          <t3>Tarjetas de credito/débito:</t3>
          </br>
          <img src="{% static 'dist/img/credit/visa.png' %}" alt="Visa">
          <img src="{% static 'dist/img/credit/mastercard.png' %}" alt="Mastercard">
          <img src="{% static 'dist/img/credit/american-express.png' %}" alt="American Express">
          </br>
          <t3>Bancos:</t3>
          <p class="text-muted well well-sm shadow-none" style="margin-top: 10px;">
            Bancolombia, Banco de Bógota, BBVA
          </p>
        </div>
        <!-- /.col -->
        <div class="col-6">

          <div class="table-responsive">
            <table class="table">
              <tr>
                <th style="width:50%">FECHA DE VENCIMIENTO:</th>
                <td>{{hoy}}</td>
              </tr>
              <tr>
                <th>RECONECCIÓN</th>
                <td>{{r}}</td>
              </tr>
              <tr>
                <th>TOTAL:</th>
                <td>${{total}}</td>
              </tr>
            </table>
          </div>
        </div>
        <!-- /.col -->
      </div>
      <!-- /.row -->
      <div>
        <img src="{% static 'dist/img/ads1.jpg' %}" width="300" height="140">
        <img src="{% static 'dist/img/ads3.jpg' %}" width="277" height="140">
        <img src="{% static 'dist/img/ads2.jpg' %}" width="380" height="140">
      </div>
      </br>
      <!-- this row will not appear when printing -->
      <div class="row no-print">
        <div class="col-12">
          <button type="button" onclick="makePDF();" class="btn btn-primary float-left">
            <i class="fas fa-download"></i> Generar PDF
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="ignorePDF"></div>
  <!-- /.invoice -->


  <!-- Control Sidebar -->
  <aside class="control-sidebar control-sidebar-dark">
    <!-- Control sidebar content goes here -->
  </aside>
  <!-- /.control-sidebar -->
  </div>
  <!-- ./wrapper -->

  <!-- jQuery -->
  <script src="../../plugins/jquery/jquery.min.js"></script>
  <!-- Bootstrap 4 -->
  <script src="../../plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
  <!-- AdminLTE App -->
  <script src="../../dist/js/adminlte.min.js"></script>
  <!-- AdminLTE for demo purposes -->
  <script src="../../dist/js/demo.js"></script>

  <script type="text/javascript">
    function generateSerial() {

      'use strict';

      var chars = '1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ',

        serialLength = 10,

        randomSerial = "",

        i,

        randomNumber;

      for (i = 0; i < serialLength; i = i + 1) {

        randomNumber = Math.floor(Math.random() * chars.length);

        randomSerial += chars.substring(randomNumber, randomNumber + 1);

      }

      return randomSerial

    }
    var serial = generateSerial();
    document.getElementById('x').innerHTML = serial;

    function makePDF() {
      document.title = 'Factura N° ' + serial;
      window.addEventListener("load", window.print());
    }
  </script>
</body>

</html>